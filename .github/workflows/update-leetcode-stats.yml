name: Update LeetCode Stats
on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Update LeetCode Stats in README
        run: |
          curl -s 'https://leetcode.com/graphql' \
            -H 'User-Agent: Mozilla/5.0' \
            -H 'Content-Type: application/json' \
            -d '{
              "query": "query { matchedUser(username: \"aritichawla2110\") { submitStatsGlobal { acSubmissionNum { difficulty count } } } }"
            }' | python3 -c "
import sys, json
data = json.load(sys.stdin)
if 'data' in data:
    stats = data['data']['matchedUser']['submitStatsGlobal']['acSubmissionNum']
    easy = medium = hard = 0
    for s in stats:
        if s['difficulty'] == 'Easy': easy = s['count']
        elif s['difficulty'] == 'Medium': medium = s['count']
        elif s['difficulty'] == 'Hard': hard = s['count']
    total = easy + medium + hard
    readme = f'''# aritichawla2110\n\n## About Me\nData Scientist | Software Developer | AI/ML Enthusiast\n\n## LeetCode Stats\n[![LeetCode](https://img.shields.io/badge/LeetCode-FFA116?style=flat&logo=leetcode&logoColor=black)](https://leetcode.com/u/aritichawla2110/)\n\n- **Total**: {total}
- **Easy**: {easy} âœ…
- **Medium**: {medium} ðŸŸ¡  
- **Hard**: {hard} ðŸ”´\n\n*Updated: $(date)*\n\n## Connect\n- [LeetCode](https://leetcode.com/u/aritichawla2110/)
- [GitHub](https://github.com/ariti2110)
- [LinkedIn](https://linkedin.com/in/ariti-chawla)'''
    with open('README.md', 'w') as f:
        f.write(readme)
" 2>/dev/null || echo 'Failed to fetch stats'
      
      - name: Commit changes
        run: |
          git config user.email "action@github.com"
          git config user.name "GitHub Actions"
          if git diff --quiet README.md; then
            echo "No changes"
          else
            git add README.md
            git commit -m "ðŸ”„ Update LeetCode stats [$(date +'%Y-%m-%d')]"
            git push
          fi
