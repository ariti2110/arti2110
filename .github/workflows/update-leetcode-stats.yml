name: Update LeetCode Stats
on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:
permissions:
  contents: write
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Update README
        run: |
          cat > update_stats.py << 'EOF'
import requests
import json
from datetime import datetime
username = "aritichawla2110"
query = "query { matchedUser(username: \\"aritichawla2110\\") { submitStatsGlobal { acSubmissionNum { difficulty count } } } }"
headers = {"User-Agent": "Mozilla/5.0", "Content-Type": "application/json"}
response = requests.post("https://leetcode.com/graphql", json={"query": query}, headers=headers, timeout=10)
data = response.json()
if "data" in data and data["data"]["matchedUser"]:
  stats = data["data"]["matchedUser"]["submitStatsGlobal"]["acSubmissionNum"]
  easy = medium = hard = 0
  for s in stats:
    if s["difficulty"] == "Easy": easy = s["count"]
    elif s["difficulty"] == "Medium": medium = s["count"]
    elif s["difficulty"] == "Hard": hard = s["count"]
  total = easy + medium + hard
  content = f"""# aritichawla2110\n\n## About\nData Scientist | Software Developer | AI/ML Enthusiast\n\n## LeetCode Stats\n- Total: {total}\n- Easy: {easy}\n- Medium: {medium}\n- Hard: {hard}\n\nUpdated: {datetime.now().isoformat()}\n\n[View Profile](https://leetcode.com/u/aritichawla2110/)"""
  open("README.md", "w").write(content)
EOF
          pip install requests
          python3 update_stats.py
      - name: Commit
        run: |
          git config user.email "action@github.com"
          git config user.name "GitHub Action"
          git add -A
          git diff --quiet && git diff --staged --quiet || git commit -m "Update LeetCode stats" && git push
